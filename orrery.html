<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Orrery with Real NEO Data</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="orreryCanvas"></canvas>

    <script type="module">
    //Imports
    import * as THREE from 'https://cdn.skypack.dev/three@0.128.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/OrbitControls.js';

    //Constants
    DEG_TO_RAD = Math.PI / 180;
    AU_SCALE_FACTOR = 50;
    SUN_MESH_N = 32;
    
    //Setup Scene
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
    const renderer = new THREE.WebGLRenderer({antialias:true, canvas: document.getElementById("my_canvas")});
    renderer.setSize(window.innerWidth, window.innerHeight);

    camera.position.set(100, 100, 100);
    camera.lookAt(0,0,0);

    //Setup Controls
    const controls = new OrbitControls(amera, renderer.domElement);
    controls.enableDamping = true;
    controls.update();

    //Setup Event Listeners
    
    

    //Functions
    function processPlanetData() { //process the planet data and initialize the scene
        for (const [planetName, planetData] of Object.entries(planets)) {
                //convert the orbital parameters into the values that will be used by other functions
                planetData.orbParams.i *= DEG_TO_RAD;
                planetData.orbParams.lan *= DEG_TO_RAD;
                planetData.orbParams.aop *= DEG_TO_RAD;
                planetData.orbParams.ma *= DEG_TO_RAD;
                planetData.orbParams.ma -= planetData.orbParams.aop;
                planetData.orbParams.aop -= planetData.orbParams.lan;
                
                createOrbit(planetData.orbParams, planetData.renderParams.color); //create the orbit and its mesh

                //create the meshes for the planets and add them to the scene
                const geometry = new THREE.SphereGeometry(planetData.renderParams.radius, planetData.renderParams.meshN, planetData.renderParams.meshN); 
                const material = new THREE.MeshBasicMaterial({color: planetData.renderParams.color}); 
                const planetMesh = new THREE.Mesh( geometry, material );
                

            planet_meshes

                scene.add(sphere);
        }

    }


    //Data

    planets = dict([
    ("Mercury", ["dimgrey", np.array([0.38709893, 0.20563069, 7.00487, 48.33167, 77.45645, 252.25084])]),
    ("Venus", ["chocolate", np.array([0.72333199, 0.00677323, 3.39471, 76.68069, 131.53298, 181.97973])]),
    ("Earth", ["mediumblue", np.array([1.00000011, 0.01671022, 0.00005, -11.26064, 102.94719, 100.46435])]),
    ("Mars", ["firebrick", np.array([1.52366231, 0.09341233, 1.85061, 49.57854, 336.04084, 355.45332])]),
    ("Jupiter", ["darkorange", np.array([5.20336301, 0.04839266, 1.30530, 100.55615, 14.75385, 34.40438])]),
    ("Saturn", ["peachpuff", np.array([9.53707032, 0.05415060, 2.48446, 113.71504, 92.43194, 49.94432])]),
    ("Uranus", ["lightblue", np.array([19.19126393, 0.04716771, 0.76986, 74.22988, 170.96424, 313.23218])]),
    ("Neptune", ["royalblue", np.array([30.06896348, 0.00858587, 1.76917, 131.72169, 44.97135, 304.88003])]),
    ("Pluto", ["tan", np.array([39.48168677, 0.24880766, 17.14175, 110.30347, 224.06676, 238.92881])])])

    let planets;
    let planetMeshes;

    [0.40, 0.45, 0.60, 0.50, 0.80]
    [0xffff00, 0xcc9966, 0xff9900, 0x0000ff, 0xff0000, 0xffcc00]

    planets.Mercury = {OrbitParams: {epoch: 2451545, a: 0.38709893, e:  0.20563069, inc: 7.00487, node: 48.33167, peri: 29.12478, ma:	174.79439}, renderParams: {radius: 0.40, meshN: SUN_MESH_N / 2, color: 0xffff00}}
    planets.Venus = {OrbitParams: {epoch: 2451545, a: 0.72333199, e: 0.00677323, inc: 3.39471, node: 76.68069, peri: 54.85229, ma: 50.44675}}
    planets.Earth = {OrbitParams: {epoch: 2451545, a: 1.00000011, e: 0.01671022, inc: 0.00005, node: -11.26064, peri: 114.20783, ma: 357.51716}} //chatgpt baby
    planets.Mars = {OrbitParams: {epoch: 2451545, a: 1.52366231, e: 0.09341233, inc: 1.85061, node: 49.57854, peri: 286.4623, ma:	19.41248}}
    planets.Jupiter = {OrbitParams: {epoch: 2451545, a: 5.20336301, e: 0.04839266, inc: 1.30530, node: 100.55615, peri: -85.8023, ma:	19.65053}}
    planets.Saturn = {OrbitParams: {epoch: 2451545, a: 9.53707032, e: 0.05415060, inc: 2.48446, node: 113.71504, peri: -21.2831, ma: -42.48762}}
    planets.Uranus = {OrbitParams: {epoch: 2451545, a: 19.19126393, e: 0.04716771, inc: 0.76986, node: 74.22988, peri: 96.73436, ma: 142.26794}}
    planets.Neptune = {OrbitParams: {epoch: 2451545, a: 30.06896348, e: 0.00858587, inc: 1.76917, node: 131.72169, peri: -86.75034, ma: 259.9086}}
    planets.Pluto = {OrbitParams: {epoch: 2451545, a: 39.48168677, e: 0.24880766, inc: 17.14175, node: 110.30347, peri: 113.834, ma: 14.950}} //chatgpt baby

    //The animation loop function which updates the scene (keep at the bottom of the file)
    function animate() {
        requestAnimationFrame(animate);

        for (const [planetName, planetData] of Object.entries(planets)) {
            planetData.orbParams = 0;
        }


        controls.update();

        renderer.render(scene, camera);
    }

    renderer.setAnimationLoop(animate);

</script>
</body>
</html>